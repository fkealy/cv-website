---
---

<nav class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full max-w-4xl px-4">
  <div class="bg-white border-2 border-gray-300 shadow-lg">
    <div class="flex justify-between items-center px-6 py-4">
      <a href="/" class="text-2xl font-bold text-gray-900 hover:text-primary-600 transition-colors duration-300 uppercase tracking-tight" data-nav-link="/">
        FK
      </a>
      <div class="flex gap-6">
        <a href="/#projects" class="text-gray-900 hover:text-primary-600 font-bold transition-colors duration-300 uppercase text-sm tracking-wide">
          Projects
        </a>
        <a href="/blog" class="text-gray-900 hover:text-primary-600 font-bold transition-colors duration-300 uppercase text-sm tracking-wide" data-nav-link="/blog">
          Blog
        </a>
        <a href="/flappy-bee/bee.html" class="text-2xl hover:scale-110 transition-transform duration-300" title="Play Flappy Bee!">
          üêù
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  // Prevent view transitions when navigating to the same page
  function setupNavigationHandlers() {
    const navLinks = document.querySelectorAll('a[data-nav-link]');
    const hashLinks = document.querySelectorAll('a[href^="/#"]');

    // Handle page navigation links (prevent transitions if already on page)
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const targetPath = link.getAttribute('data-nav-link');
        const currentPath = window.location.pathname;

        // If we're already on the target page, prevent the navigation
        // This stops the view transition from triggering
        if (currentPath === targetPath) {
          e.preventDefault();

          // Special handling for home link - scroll to top when already on home page
          if (targetPath === '/') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }

          return;
        }
      });
    });

    // Handle hash navigation (same page, different section)
    hashLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (!href) return;

        const hash = href.split('#')[1];

        // If we're already on the home page and clicking a hash link,
        // prevent the default behavior and just scroll smoothly
        if (window.location.pathname === '/' && hash) {
          e.preventDefault();
          const targetElement = document.getElementById(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });
    });
  }

  // Set up handlers on initial load
  document.addEventListener('DOMContentLoaded', setupNavigationHandlers);

  // Re-set up handlers after each Astro navigation
  document.addEventListener('astro:page-load', setupNavigationHandlers);

  // Handle dynamic blog transitions
  function setupBlogTransitions() {
    // Set CSS custom property for blog slide direction based on navigation
    document.addEventListener('astro:before-swap', (event) => {
      const fromPath = event.from.pathname;
      const toPath = event.to.pathname;


      // If navigating FROM the blog index
      if (fromPath === '/blog') {
        if (toPath === '/' || toPath.startsWith('/#')) {
          const style = document.createElement('style');
          style.id = 'blog-transition-override';
          style.textContent = `
            ::view-transition-old(blog-content) {
              animation: slideOutRightSheet 0.6s ease-in-out forwards !important;
            }
          `;
          document.head.appendChild(style);
        } else if (toPath.startsWith('/blog/') && toPath !== '/blog') {
          // Going to a blog post - slide left (out)
          const style = document.createElement('style');
          style.id = 'blog-transition-override';
          style.textContent = `
            ::view-transition-old(blog-content) {
              animation: slideOutLeftSheet 0.6s ease-in-out forwards !important;
            }
          `;
          document.head.appendChild(style);
        }
      }

      // If navigating TO the blog index
      if (toPath === '/blog') {
        if (fromPath === '/' || fromPath.startsWith('/#')) {
          // Coming from home - slide in from right
          console.log('Blog: coming from home, slide in from RIGHT');
          const style = document.createElement('style');
          style.id = 'blog-transition-override-in';
          style.textContent = `
            ::view-transition-new(blog-content) {
              animation: slideInFromRightSheet 0.6s ease-in-out forwards !important;
            }
          `;
          document.head.appendChild(style);
        } else if (fromPath.startsWith('/blog/') && fromPath !== '/blog') {
          // Coming from a blog post - slide in from left
          console.log('Blog: coming from post, slide in from LEFT');
          const style = document.createElement('style');
          style.id = 'blog-transition-override-in';
          style.textContent = `
            ::view-transition-new(blog-content) {
              animation: slideInFromLeftSheet 0.6s ease-in-out forwards !important;
            }
          `;
          document.head.appendChild(style);
        }
      }
    });

    // Clean up injected styles after transition
    document.addEventListener('astro:page-load', () => {
      const overrideStyle = document.getElementById('blog-transition-override');
      const overrideStyleIn = document.getElementById('blog-transition-override-in');
      if (overrideStyle) overrideStyle.remove();
      if (overrideStyleIn) overrideStyleIn.remove();
    });
  }

  // Set up blog transitions
  document.addEventListener('DOMContentLoaded', setupBlogTransitions);
  document.addEventListener('astro:page-load', setupBlogTransitions);
</script>
