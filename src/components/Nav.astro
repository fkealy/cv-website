---
---

<nav class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full max-w-4xl px-4">
  <div class="bg-white border-2 border-gray-300 shadow-lg">
    <div class="flex justify-between items-center px-6 py-4">
      <a href="/" class="text-2xl font-bold text-gray-900 hover:text-primary-600 transition-colors duration-300 uppercase tracking-tight" data-nav-link="/">
        FK
      </a>
      <div class="flex gap-6">
        <a href="/#projects" class="text-gray-900 hover:text-primary-600 font-bold transition-colors duration-300 uppercase text-sm tracking-wide">
          Projects
        </a>
        <a href="/blog" class="text-gray-900 hover:text-primary-600 font-bold transition-colors duration-300 uppercase text-sm tracking-wide" data-nav-link="/blog">
          Blog
        </a>
        <a href="/flappy-bee/bee.html" class="text-2xl hover:scale-110 transition-transform duration-300" title="Play Flappy Bee!">
          üêù
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  // Prevent view transitions when navigating to the same page
  function setupNavigationHandlers() {
    const navLinks = document.querySelectorAll('a[data-nav-link]');
    const hashLinks = document.querySelectorAll('a[href^="/#"]');

    // Handle page navigation links (prevent transitions if already on page)
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const targetPath = link.getAttribute('data-nav-link');
        const currentPath = window.location.pathname;

        // If we're already on the target page, prevent the navigation
        // This stops the view transition from triggering
        if (currentPath === targetPath) {
          e.preventDefault();

          // Special handling for home link - scroll to top when already on home page
          if (targetPath === '/') {
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }

          return;
        }
      });
    });

    // Handle hash navigation (same page, different section)
    hashLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (!href) return;

        const hash = href.split('#')[1];

        // If we're already on the home page and clicking a hash link,
        // prevent the default behavior and just scroll smoothly
        if (window.location.pathname === '/' && hash) {
          e.preventDefault();
          const targetElement = document.getElementById(hash);
          if (targetElement) {
            targetElement.scrollIntoView({ behavior: 'smooth' });
          }
        }
      });
    });
  }

  // Set up handlers on initial load
  document.addEventListener('DOMContentLoaded', setupNavigationHandlers);

  // Re-set up handlers after each Astro navigation
  document.addEventListener('astro:page-load', setupNavigationHandlers);

  // Handle dynamic blog transitions using CSS custom properties
  // Set CSS variables on CURRENT document before swap happens
  document.addEventListener('astro:before-swap', (event) => {
    // Normalize paths: remove trailing slashes
    const fromPath = event.from.pathname.replace(/\/$/, '');
    const toPath = event.to.pathname.replace(/\/$/, '');

    // Set CSS custom properties on the root element
    // These control the animation directions for blog transitions

    // Reset to defaults first
    document.documentElement.style.setProperty('--blog-new-animation', 'slideInFromRightSheet');
    document.documentElement.style.setProperty('--blog-old-animation', 'slideOutRightSheet');

    // If navigating TO the blog index
    if (toPath === '/blog') {
      if (fromPath === '' || fromPath === '/' || fromPath.startsWith('/#')) {
        // Home ‚Üí Blog: blog slides in from right (default is correct)
        console.log('üì• Home ‚Üí Blog: Blog slides in from RIGHT');
      }
    }

    // If navigating FROM the blog index
    if (fromPath === '/blog') {
      if (toPath === '' || toPath === '/' || toPath.startsWith('/#')) {
        // Blog ‚Üí Home: blog slides out right (default is correct)
        console.log('üì§ Blog ‚Üí Home: Blog slides out RIGHT');
      }
    }
  });

  // Reset CSS variables after transition completes
  document.addEventListener('astro:page-load', () => {
    document.documentElement.style.removeProperty('--blog-new-animation');
    document.documentElement.style.removeProperty('--blog-old-animation');
  });
</script>
